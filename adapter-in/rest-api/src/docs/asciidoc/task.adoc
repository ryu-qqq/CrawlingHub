[[resources-task]]
== CrawlTask API

크롤 태스크 관리 API입니다.

[[resources-task-retry]]
=== 태스크 재시도

`POST /api/v1/crawling/tasks/{id}/retry`

실패한 크롤 태스크를 재시도합니다.

재시도 조건:

* FAILED 또는 TIMEOUT 상태의 태스크만 재시도 가능
* 최대 재시도 횟수(3회) 미만

==== Path Parameters

|===
| Parameter | Type | Required | Description

| `id`
| Long
| Yes
| CrawlTask ID
|===

==== Request Example

[source,http]
----
POST /api/v1/crawling/tasks/1/retry HTTP/1.1
Host: localhost:8080
Authorization: Bearer {jwt-token}
----

==== Response Example

[source,json]
----
{
  "success": true,
  "data": {
    "crawlTaskId": 1,
    "status": "PENDING",
    "retryCount": 1,
    "message": "재시도가 요청되었습니다."
  },
  "error": null,
  "timestamp": "2025-01-15T12:00:00"
}
----

[[resources-task-list]]
=== 태스크 목록 조회

`GET /api/v1/crawling/tasks`

태스크 목록을 페이징 및 필터링하여 조회합니다.

==== Query Parameters

|===
| Parameter | Type | Required | Description | Example

| `crawlSchedulerId`
| Long
| No
| 크롤 스케줄러 ID 필터
| `1`

| `sellerId`
| Long
| No
| 셀러 ID 필터
| `1`

| `statuses`
| List<String>
| No
| 상태 필터 목록 (다중 선택 가능: PENDING, RUNNING, SUCCESS, FAILED, TIMEOUT)
| `statuses=SUCCESS&statuses=FAILED`

| `taskTypes`
| List<String>
| No
| 태스크 유형 필터 목록 (다중 선택 가능: META, SEARCH, DETAIL, OPTION)
| `taskTypes=META&taskTypes=DETAIL`

| `createdFrom`
| Instant
| No
| 생성일시 시작 (ISO-8601)
| `2025-01-01T00:00:00Z`

| `createdTo`
| Instant
| No
| 생성일시 종료 (ISO-8601)
| `2025-12-31T23:59:59Z`

| `page`
| Integer
| No
| 페이지 번호 (0부터 시작, 기본값: 0)
| `0`

| `size`
| Integer
| No
| 페이지 크기 (기본값: 20, 최대: 100)
| `20`
|===

==== Request Example

[source,http]
----
GET /api/v1/crawling/tasks?crawlSchedulerId=1&statuses=SUCCESS&page=0&size=20 HTTP/1.1
Host: localhost:8080
Authorization: Bearer {jwt-token}
----

==== Response Example

[source,json]
----
{
  "success": true,
  "data": {
    "content": [
      {
        "crawlTaskId": 1,
        "crawlSchedulerId": 1,
        "sellerId": 100,
        "taskType": "SEARCH",
        "status": "SUCCESS",
        "retryCount": 0,
        "createdAt": "2025-01-15T10:00:00Z",
        "completedAt": "2025-01-15T10:05:30Z"
      }
    ],
    "page": 0,
    "size": 20,
    "totalElements": 1,
    "totalPages": 1
  },
  "error": null,
  "timestamp": "2025-01-15T12:00:00"
}
----

[[resources-task-get]]
=== 태스크 상세 조회

`GET /api/v1/crawling/tasks/{id}`

==== Path Parameters

|===
| Parameter | Type | Required | Description

| `id`
| Long
| Yes
| CrawlTask ID
|===

==== Request Example

[source,http]
----
GET /api/v1/crawling/tasks/1 HTTP/1.1
Host: localhost:8080
Authorization: Bearer {jwt-token}
----

==== Response Example

[source,json]
----
{
  "success": true,
  "data": {
    "crawlTaskId": 1,
    "crawlSchedulerId": 1,
    "sellerId": 100,
    "sellerName": "테스트셀러",
    "taskType": "SEARCH",
    "status": "SUCCESS",
    "retryCount": 0,
    "payload": {...},
    "executionResult": {...},
    "createdAt": "2025-01-15T10:00:00Z",
    "startedAt": "2025-01-15T10:00:05Z",
    "completedAt": "2025-01-15T10:05:30Z"
  },
  "error": null,
  "timestamp": "2025-01-15T12:00:00"
}
----
