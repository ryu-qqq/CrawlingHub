[[resources-useragent]]
== UserAgent API

UserAgent Pool 관리 API입니다.

[[resources-useragent-pool-status]]
=== Pool 상태 조회

`GET /api/v1/crawling/user-agents/pool-status`

UserAgent Pool의 전체 상태를 조회합니다.

==== Request Example

[source,http]
----
GET /api/v1/crawling/user-agents/pool-status HTTP/1.1
Host: localhost:8080
Authorization: Bearer {jwt-token}
----

==== Response Example

[source,json]
----
{
  "success": true,
  "data": {
    "totalCount": 100,
    "availableCount": 85,
    "suspendedCount": 10,
    "blockedCount": 5,
    "averageHealthScore": 75.5
  },
  "error": null,
  "timestamp": "2025-01-15T12:00:00"
}
----

[[resources-useragent-list]]
=== UserAgent 목록 조회

`GET /api/v1/crawling/user-agents`

UserAgent 목록을 페이징 및 상태별로 필터링하여 조회합니다.

==== Query Parameters

|===
| Parameter | Type | Required | Description | Example

| `statuses`
| List<String>
| No
| 상태 필터 목록 (다중 선택 가능: AVAILABLE, SUSPENDED, BLOCKED)
| `statuses=AVAILABLE&statuses=SUSPENDED`

| `createdFrom`
| Instant
| No
| 생성일시 시작 (ISO-8601)
| `2025-01-01T00:00:00Z`

| `createdTo`
| Instant
| No
| 생성일시 종료 (ISO-8601)
| `2025-12-31T23:59:59Z`

| `page`
| Integer
| No
| 페이지 번호 (0부터 시작, 기본값: 0)
| `0`

| `size`
| Integer
| No
| 페이지 크기 (기본값: 20, 최대: 100)
| `20`
|===

==== Request Example

[source,http]
----
GET /api/v1/crawling/user-agents?statuses=AVAILABLE&page=0&size=20 HTTP/1.1
Host: localhost:8080
Authorization: Bearer {jwt-token}
----

==== Response Example

[source,json]
----
{
  "success": true,
  "data": {
    "content": [
      {
        "userAgentId": 1,
        "userAgentString": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36...",
        "status": "AVAILABLE",
        "healthScore": 100,
        "totalRequests": 1500,
        "successRequests": 1480,
        "createdAt": "2025-01-01T00:00:00Z",
        "updatedAt": "2025-01-15T10:00:00Z"
      }
    ],
    "page": 0,
    "size": 20,
    "totalElements": 85,
    "totalPages": 5
  },
  "error": null,
  "timestamp": "2025-01-15T12:00:00"
}
----

[[resources-useragent-detail]]
=== UserAgent 상세 조회

`GET /api/v1/crawling/user-agents/{userAgentId}`

특정 UserAgent의 상세 정보를 조회합니다. Redis Pool 상태 정보도 함께 반환됩니다.

==== Path Parameters

|===
| Parameter | Type | Required | Description

| `userAgentId`
| Long
| Yes
| UserAgent ID
|===

==== Request Example

[source,http]
----
GET /api/v1/crawling/user-agents/1 HTTP/1.1
Host: localhost:8080
Authorization: Bearer {jwt-token}
----

==== Response Example

[source,json]
----
{
  "success": true,
  "data": {
    "userAgentId": 1,
    "userAgentString": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36...",
    "status": "AVAILABLE",
    "healthScore": 100,
    "totalRequests": 1500,
    "successRequests": 1480,
    "failedRequests": 20,
    "lastUsedAt": "2025-01-15T11:55:00Z",
    "poolInfo": {
      "isInPool": true,
      "poolScore": 100.0
    },
    "createdAt": "2025-01-01T00:00:00Z",
    "updatedAt": "2025-01-15T10:00:00Z"
  },
  "error": null,
  "timestamp": "2025-01-15T12:00:00"
}
----

[[resources-useragent-recover]]
=== UserAgent 복구

`POST /api/v1/crawling/user-agents/recover`

정지된 UserAgent를 복구합니다.

복구 조건:

* SUSPENDED 상태
* 1시간 경과
* Health Score >= 30

==== Request Example

[source,http]
----
POST /api/v1/crawling/user-agents/recover HTTP/1.1
Host: localhost:8080
Authorization: Bearer {jwt-token}
----

==== Response Example

[source,json]
----
{
  "success": true,
  "data": {
    "recoveredCount": 5,
    "message": "5개의 UserAgent가 복구되었습니다."
  },
  "error": null,
  "timestamp": "2025-01-15T12:00:00"
}
----

[[resources-useragent-recover-no-agents]]
=== UserAgent 복구 (복구 대상 없음)

`POST /api/v1/crawling/user-agents/recover` (복구 대상이 없는 경우)

==== Response Example

[source,json]
----
{
  "success": true,
  "data": {
    "recoveredCount": 0,
    "message": "복구 대상 UserAgent가 없습니다."
  },
  "error": null,
  "timestamp": "2025-01-15T12:00:00"
}
----

[[resources-useragent-update-status]]
=== UserAgent 상태 일괄 변경

`PATCH /api/v1/crawling/user-agents/status`

여러 UserAgent의 상태를 일괄 변경합니다.

변경 가능한 상태:

* `AVAILABLE` - 사용 가능
* `SUSPENDED` - 정지
* `BLOCKED` - 차단

==== Request Body

|===
| Field | Type | Required | Description

| `userAgentIds`
| List<Long>
| Yes
| 상태를 변경할 UserAgent ID 목록

| `status`
| String
| Yes
| 변경할 상태 (AVAILABLE, SUSPENDED, BLOCKED)
|===

==== Request Example

[source,http]
----
PATCH /api/v1/crawling/user-agents/status HTTP/1.1
Host: localhost:8080
Authorization: Bearer {jwt-token}
Content-Type: application/json

{
  "userAgentIds": [1, 2, 3, 4, 5],
  "status": "SUSPENDED"
}
----

==== Response Example

[source,json]
----
{
  "success": true,
  "data": {
    "updatedCount": 5,
    "message": "5개의 UserAgent 상태가 SUSPENDED로 변경되었습니다."
  },
  "error": null,
  "timestamp": "2025-01-15T12:00:00"
}
----

[[resources-useragent-update-status-single]]
=== UserAgent 상태 변경 (단일)

`PATCH /api/v1/crawling/user-agents/status` (단일 UserAgent)

단일 UserAgent의 상태를 변경합니다.

==== Request Example

[source,http]
----
PATCH /api/v1/crawling/user-agents/status HTTP/1.1
Host: localhost:8080
Authorization: Bearer {jwt-token}
Content-Type: application/json

{
  "userAgentIds": [1],
  "status": "BLOCKED"
}
----

==== Response Example

[source,json]
----
{
  "success": true,
  "data": {
    "updatedCount": 1,
    "message": "1개의 UserAgent 상태가 BLOCKED로 변경되었습니다."
  },
  "error": null,
  "timestamp": "2025-01-15T12:00:00"
}
----

