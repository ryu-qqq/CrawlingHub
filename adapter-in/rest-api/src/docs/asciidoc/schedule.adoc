[[resources-schedule]]
== CrawlScheduler API

크롤 스케줄러 관리 API입니다.

[[resources-schedule-register]]
=== 스케줄러 등록

`POST /api/v1/crawling/schedules`

새 크롤 스케줄러를 등록합니다.

==== Request Body

|===
| Field | Type | Required | Description

| `sellerId`
| Long
| Yes
| 셀러 ID

| `sellerBaseUrl`
| String
| Yes
| 셀러 기본 URL

| `cronExpression`
| String
| Yes
| Cron 표현식

| `crawlType`
| String
| Yes
| 크롤 유형 (FULL, INCREMENTAL)

| `priority`
| Integer
| No
| 우선순위 (기본값: 5)
|===

==== Request Example

[source,http]
----
POST /api/v1/crawling/schedules HTTP/1.1
Host: localhost:8080
Authorization: Bearer {jwt-token}
Content-Type: application/json

{
  "sellerId": 1,
  "sellerBaseUrl": "https://example.com",
  "cronExpression": "0 0 * * * ?",
  "crawlType": "FULL",
  "priority": 5
}
----

==== Response Example

[source,json]
----
{
  "success": true,
  "data": {
    "crawlSchedulerId": 1,
    "message": "스케줄러가 등록되었습니다."
  },
  "error": null,
  "timestamp": "2025-01-15T12:00:00"
}
----

[[resources-schedule-update]]
=== 스케줄러 수정

`PATCH /api/v1/crawling/schedules/{id}`

스케줄러 정보를 수정합니다.

==== Path Parameters

|===
| Parameter | Type | Required | Description

| `id`
| Long
| Yes
| CrawlScheduler ID
|===

[[resources-schedule-update-status]]
=== 스케줄러 상태 변경

`PATCH /api/v1/crawling/schedules/{id}/status`

스케줄러를 활성화/비활성화합니다.

* `active: true` → ACTIVE 상태로 변경
* `active: false` → INACTIVE 상태로 변경

==== Path Parameters

|===
| Parameter | Type | Required | Description

| `id`
| Long
| Yes
| CrawlScheduler ID
|===

==== Request Body

|===
| Field | Type | Required | Description

| `active`
| Boolean
| Yes
| 활성화 여부
|===

[[resources-schedule-trigger]]
=== 스케줄러 수동 트리거

`POST /api/v1/crawling/schedules/{id}/trigger`

스케줄러를 수동으로 트리거하여 즉시 크롤 태스크를 생성합니다.

NOTE: ACTIVE 상태의 스케줄러만 트리거할 수 있습니다.

==== Path Parameters

|===
| Parameter | Type | Required | Description

| `id`
| Long
| Yes
| CrawlScheduler ID
|===

[[resources-schedule-list]]
=== 스케줄러 목록 조회

`GET /api/v1/crawling/schedules`

스케줄러 목록을 페이징 및 필터링하여 조회합니다.

==== Query Parameters

|===
| Parameter | Type | Required | Description | Example

| `sellerId`
| Long
| No
| 셀러 ID 필터
| `1`

| `statuses`
| List<String>
| No
| 상태 필터 목록 (다중 선택 가능: ACTIVE, INACTIVE)
| `statuses=ACTIVE&statuses=INACTIVE`

| `createdFrom`
| Instant
| No
| 생성일 시작 (ISO-8601)
| `2025-01-01T00:00:00Z`

| `createdTo`
| Instant
| No
| 생성일 종료 (ISO-8601)
| `2025-12-31T23:59:59Z`

| `page`
| Integer
| No
| 페이지 번호 (0부터 시작, 기본값: 0)
| `0`

| `size`
| Integer
| No
| 페이지 크기 (기본값: 20, 최대: 100)
| `20`
|===

==== Request Example

[source,http]
----
GET /api/v1/crawling/schedules?statuses=ACTIVE&page=0&size=20 HTTP/1.1
Host: localhost:8080
Authorization: Bearer {jwt-token}
----

==== Response Example

[source,json]
----
{
  "success": true,
  "data": {
    "content": [
      {
        "crawlSchedulerId": 1,
        "sellerId": 1,
        "sellerName": "테스트셀러",
        "cronExpression": "0 0 * * * ?",
        "crawlType": "FULL",
        "status": "ACTIVE",
        "priority": 5,
        "lastExecutedAt": "2025-01-15T10:00:00Z",
        "nextExecutionAt": "2025-01-15T11:00:00Z",
        "createdAt": "2025-01-01T00:00:00Z"
      }
    ],
    "page": 0,
    "size": 20,
    "totalElements": 1,
    "totalPages": 1
  },
  "error": null,
  "timestamp": "2025-01-15T12:00:00"
}
----

[[resources-schedule-detail]]
=== 스케줄러 상세 조회

`GET /api/v1/crawling/schedules/{crawlSchedulerId}`

크롤 스케줄러의 상세 정보를 조회합니다. 셀러 정보, 실행 정보, 통계, 최근 태스크 목록을 포함합니다.

==== Path Parameters

|===
| Parameter | Type | Required | Description

| `crawlSchedulerId`
| Long
| Yes
| CrawlScheduler ID
|===

==== Request Example

[source,http]
----
GET /api/v1/crawling/schedules/1 HTTP/1.1
Host: localhost:8080
Authorization: Bearer {jwt-token}
----

==== Response Example

[source,json]
----
{
  "success": true,
  "data": {
    "crawlSchedulerId": 1,
    "sellerId": 1,
    "sellerName": "테스트셀러",
    "cronExpression": "0 0 * * * ?",
    "crawlType": "FULL",
    "status": "ACTIVE",
    "priority": 5,
    "lastExecutedAt": "2025-01-15T10:00:00Z",
    "nextExecutionAt": "2025-01-15T11:00:00Z",
    "statistics": {
      "totalExecutions": 100,
      "successCount": 95,
      "failCount": 5,
      "averageDuration": 120
    },
    "recentTasks": [...],
    "createdAt": "2025-01-01T00:00:00Z",
    "updatedAt": "2025-01-15T10:00:00Z"
  },
  "error": null,
  "timestamp": "2025-01-15T12:00:00"
}
----
