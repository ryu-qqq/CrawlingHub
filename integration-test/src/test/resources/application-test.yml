# ===============================================
# Integration Test Configuration
# ===============================================
# Profile: test
# TestContainers provides dynamic database/redis/sqs connections
# WireMock provides external API mocking
# ===============================================

spring:
  # ===============================================
  # Flyway Configuration
  # ===============================================
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
    baseline-version: 0
    validate-on-migrate: false
    clean-disabled: false
    fail-on-missing-locations: true

  # ===============================================
  # JPA Configuration
  # ===============================================
  jpa:
    open-in-view: false
    hibernate:
      ddl-auto: validate
    properties:
      hibernate:
        format_sql: true
        use_sql_comments: true
    show-sql: true

  # ===============================================
  # Jackson Configuration
  # ===============================================
  jackson:
    date-format: yyyy-MM-dd'T'HH:mm:ss
    time-zone: Asia/Seoul
    serialization:
      WRITE_DATES_AS_TIMESTAMPS: false
      FAIL_ON_EMPTY_BEANS: false
    deserialization:
      FAIL_ON_UNKNOWN_PROPERTIES: false

marketplace:
  client:
    base-url: http://localhost:${marketplace.wiremock.port:0}

# ===============================================
# Logging Configuration
# ===============================================
logging:
  level:
    root: INFO
    com.ryuqq.crawlinghub: DEBUG
    org.springframework.web: DEBUG
    org.springframework.test: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.orm.jdbc.bind: TRACE
    org.testcontainers: INFO
    com.github.tomakehurst.wiremock: DEBUG
    io.awspring.cloud.sqs: DEBUG
    software.amazon.awssdk: WARN

# ===============================================
# SQS Publisher Configuration (sqs-client module)
# ===============================================
# Queue URLs are injected via DynamicPropertySource
sqs:
  region: us-east-1
  queues:
    crawl-task: ${SQS_CRAWL_TASK_QUEUE_URL:}
    product-sync: ${SQS_PRODUCT_SYNC_QUEUE_URL:}

# ===============================================
# Application-level SQS toggle
# ===============================================
app:
  messaging:
    sqs:
      enabled: true

# ===============================================
# SQS Listener Configuration (sqs-consumer module)
# ===============================================
aws:
  sqs:
    listener:
      # Main Queue Listeners
      crawl-task-listener-enabled: true
      event-bridge-trigger-listener-enabled: false
      product-sync-listener-enabled: false
      # DLQ Listeners (disabled for tests - no DLQ URLs in test environment)
      crawl-task-dlq-listener-enabled: false

# ===============================================
# Management (Disable for tests)
# ===============================================
# ===============================================
# Security Configuration
# ===============================================
security:
  service-token:
    enabled: true
    secret: test-service-token

management:
  endpoints:
    web:
      exposure:
        include: health
