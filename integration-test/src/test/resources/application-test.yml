# ===============================================
# Integration Test Configuration
# ===============================================
# Profile: test
# TestContainers provides dynamic database/redis/sqs connections
# WireMock provides external API mocking
# ===============================================

spring:
  # ===============================================
  # Flyway Configuration
  # ===============================================
  flyway:
    enabled: true
    locations: classpath:db/migration
    baseline-on-migrate: true
    baseline-version: 0
    validate-on-migrate: false
    clean-disabled: false
    fail-on-missing-locations: true

  # ===============================================
  # JPA Configuration
  # ===============================================
  jpa:
    open-in-view: false
    hibernate:
      ddl-auto: validate
    properties:
      hibernate:
        format_sql: true
        use_sql_comments: true
    show-sql: true

  # ===============================================
  # Jackson Configuration
  # ===============================================
  jackson:
    date-format: yyyy-MM-dd'T'HH:mm:ss
    time-zone: Asia/Seoul
    serialization:
      WRITE_DATES_AS_TIMESTAMPS: false
      FAIL_ON_EMPTY_BEANS: false
    deserialization:
      FAIL_ON_UNKNOWN_PROPERTIES: false

# ===============================================
# WireMock Endpoints (Dynamic ports set by tests)
# ===============================================
fileflow:
  client:
    base-url: http://localhost:${fileflow.wiremock.port:0}
    callback-url: http://localhost:8080/api/v1/webhook/image-upload
    connect-timeout: 5000
    read-timeout: 30000
    service-token: test-token
    service-name: crawlinghub-test

marketplace:
  client:
    base-url: http://localhost:${marketplace.wiremock.port:0}

# ===============================================
# Logging Configuration
# ===============================================
logging:
  level:
    root: INFO
    com.ryuqq.crawlinghub: DEBUG
    org.springframework.web: DEBUG
    org.springframework.test: DEBUG
    org.hibernate.SQL: DEBUG
    org.hibernate.orm.jdbc.bind: TRACE
    org.testcontainers: INFO
    com.github.tomakehurst.wiremock: DEBUG
    io.awspring.cloud.sqs: DEBUG
    software.amazon.awssdk: WARN

# ===============================================
# AWS SQS Configuration (for Worker tests)
# ===============================================
# Queue URLs and credentials are injected via DynamicPropertySource
aws:
  sqs:
    listener:
      crawl-task-listener-enabled: true
      event-bridge-trigger-listener-enabled: false

# ===============================================
# Management (Disable for tests)
# ===============================================
management:
  endpoints:
    web:
      exposure:
        include: health
