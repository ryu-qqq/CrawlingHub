# ===============================================
# Local Development Configuration
# ===============================================
# Docker Compose 기반 로컬 개발 환경 설정
#
# 사용법:
#   1. docker-compose -f docker-compose.local.yml up -d
#   2. ./gradlew :bootstrap:bootstrap-web-api:bootRun --args='--spring.profiles.active=local'
#
# @author Claude Code
# @since 1.0.0
# ===============================================

# ===============================================
# Spring Configuration
# ===============================================
spring:
  # ===============================================
  # DataSource Configuration (MySQL)
  # ===============================================
  datasource:
    # JDBC URL
    url: jdbc:mysql://localhost:3308/crawling_hub?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=Asia/Seoul

    # Credentials
    username: crawlinghub_user
    password: crawlinghub_password

    # Connection Pool (HikariCP)
    hikari:
      # 최소 유휴 커넥션
      minimum-idle: 5
      # 최대 커넥션 풀 크기
      maximum-pool-size: 20
      # 커넥션 타임아웃 (30초)
      connection-timeout: 30000
      # 유휴 타임아웃 (10분)
      idle-timeout: 600000
      # 최대 수명 (30분)
      max-lifetime: 1800000

  # ===============================================
  # JPA Configuration
  # ===============================================
  jpa:
    # Hibernate DDL Auto
    # local: validate (Flyway가 스키마 관리)
    hibernate:
      ddl-auto: validate

    # SQL 로깅
    show-sql: true

    # SQL 포맷팅
    properties:
      hibernate:
        format_sql: true
        use_sql_comments: true

        # Dialect
        dialect: org.hibernate.dialect.MySQL8Dialect

        # JDBC Batch Size
        jdbc:
          batch_size: 20

        # Query Cache
        cache:
          use_second_level_cache: false
          use_query_cache: false

  # ===============================================
  # Redis Configuration
  # ===============================================
  data:
    redis:
      # Host & Port
      host: localhost
      port: 6379

      # Password
      password: redis_password

      # Timeout
      timeout: 2000ms

      # Lettuce (Redis Client)
      lettuce:
        pool:
          # 최소 유휴 커넥션
          min-idle: 2
          # 최대 활성 커넥션
          max-active: 10
          # 최대 유휴 커넥션
          max-idle: 5
          # 대기 시간
          max-wait: 1000ms

  # ===============================================
  # Flyway Configuration (Local)
  # ===============================================
  flyway:
    # Clean 활성화 (로컬 개발 전용)
    clean-disabled: false

    # Out of Order 허용 (개발 중 마이그레이션 수정)
    out-of-order: true

# ===============================================
# AWS Configuration (LocalStack)
# ===============================================
aws:
  # LocalStack Credentials (더미 값)
  credentials:
    access-key: test
    secret-key: test

  # LocalStack Endpoint
  endpoint: http://localhost:4566

  # Region
  region: ap-northeast-2

  # SQS Configuration
  sqs:
    schedule-trigger-queue-name: seller-crawl-schedule-trigger.fifo
    target-queue-url: http://localhost:4566/000000000000/seller-crawl-schedule-trigger.fifo

  # EventBridge Configuration
  eventbridge:
    target:
      arn: arn:aws:sqs:ap-northeast-2:000000000000:seller-crawl-schedule-trigger.fifo

# ===============================================
# Logging Configuration (Local)
# ===============================================
logging:
  level:
    # Root Logger
    root: INFO

    # Application Logger
    com.ryuqq: DEBUG

    # Spring Framework
    org.springframework.web: DEBUG
    org.springframework.security: DEBUG

    # Hibernate SQL
    org.hibernate.SQL: DEBUG
    org.hibernate.type.descriptor.sql.BasicBinder: TRACE

    # AWS SDK
    com.amazonaws: DEBUG

  # Console Pattern
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %highlight(%-5level) %logger{36} - %msg%n"

# ===============================================
# Management & Actuator (Local)
# ===============================================
management:
  endpoints:
    web:
      exposure:
        # 모든 엔드포인트 노출 (로컬 개발 전용)
        include: "*"

  endpoint:
    health:
      show-details: always  # 상세 정보 항상 표시
